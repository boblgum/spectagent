services:
  spectagent:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      args:
        AGENT: ${AGENT:-opencode}
    image: spectagent:latest
    container_name: spectagent
    stdin_open: true   # docker run -i
    tty: true          # docker run -t
    working_dir: /workspace
    environment:
      - AGENT=${AGENT:-opencode}

    volumes:
      # ── Workspace (app folder) ──────────────────────────────────────
      # Created on host if it does not exist
      - ${APP_DIR:-../workspace}:/workspace

      # ── Configuration mounts (read-only where possible) ─────────────
      # Agent config (only the selected agent's config dir is mounted)
      - ${AGENT_CONFIG_DIR:-../config/${AGENT:-opencode}}:/root/.config/${AGENT:-opencode}

      # git global config
      - ${GIT_CONFIG_FILE:-../config/git/.gitconfig}:/root/.gitconfig:ro

    # ── Secrets ───────────────────────────────────────────────────────
    # Defined by each user in docker-compose.secrets.yml
    # (see docker-compose.secrets.yml.example)

